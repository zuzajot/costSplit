        {% extends 'base.html' %}

        {% block title %} Nowy payment {% endblock %}

        {% block content %}
{# Tytuł #}
        <h1> uregulować? </h1>
        <form action="" method="post" oninput="przelicz()">
            {% csrf_token %}
{# Pola formularza #}
        <table style="width: 100%; margin-top: 40px">
        {% for field in form %}
                 <tr style="height: 95px">
                     <td style="width:20%">{{ field.errors }}{{ field.label_tag }}</td>
                     <td style="width:35%">{{ field }}</td>
                     <td><button type="button" onclick="amount.value = round2(max_amount); przelicz()">spłać wszystko</button> </td>
                     {% if field.help_text %}
                        <td><p class="help">{{ field.help_text|safe }}</p></td>
                      {% endif %}
                 </tr>
        {% endfor %}
        </table>
{# interaktywna lista spłacanych #}
    <table style="width: 100%;">
                <tr>
                     <td style="width:30%"><b>komu?</b></td>
                     <td style="width:25%"><b>ile?</b></td>
                    <td><b>ile będziesz dłużny?</b></td>
                 </tr>
        {% for creditor in creditors %}
              <tr>
                     <td>{{creditor.user_id.user.username}} </td>
                     <td><span id="{{creditor.user_id.user.id}}">{{creditor.balance}}</span></td>
                  <td><span id="{{creditor.user_id.user.id}}zostalo">{{creditor.balance}}</span></td>
                 </tr>
        {% endfor %}
      </table>
{# wysłanie formularza #}
            <div class="link">
                <input type="submit" value="- ureguluj"/></div>
        </form>




{# "Wróc" #}
          <div class="link">
              <button onclick="history.back()">wróć</button></div>
<script>

function round2(number){
    return Number(Math.round(number+ 'e+2') + 'e-2');
}
function float_from_coma_separaotor(text){
    return parseFloat(text.replace(",","."));
}

document.querySelector('[for="id_amount"]').innerHTML = "kwota:";
var _str = "{{ user_balance.balance }}";
var __str = _str.replace(",",".");
var max_amount = -1 * parseFloat(__str) ;
var amount = document.getElementById('id_amount');
amount.placeholder='0.00';
amount.min = "0.01";
amount.step= "0.01";
amount.max = round2(max_amount);
amount.value = round2(max_amount);

var creditors = [];
var total_credit = 0
{% for creditor in creditors %}
var _value = float_from_coma_separaotor('{{creditor.balance}}');
_dic = {};
_dic['wplynie'] = document.getElementById("{{creditor.user_id.user.id}}");
_dic['zostanie'] = document.getElementById("{{creditor.user_id.user.id}}zostalo");
_dic['credit'] = _value;
creditors.push(_dic);
total_credit += _value;
{% endfor %}

function przelicz(){
    for (var creditor of creditors) {
        var rating = creditor['credit'] / total_credit;
        var now_amount = amount.value;
        creditor['wplynie'].innerHTML = round2( now_amount * rating );
        creditor['zostanie'].innerHTML = round2( max_amount * rating - now_amount * rating);
    }
}
przelicz();
</script>

{% endblock %}